<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MCUX CLNS: mcuxClPsaDriver_keygen_export_public_key_oracle_example.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MCUX CLNS
   </div>
   <div id="projectbrief">MCUX Crypto Library Normal Secure</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a01358.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mcuxClPsaDriver_keygen_export_public_key_oracle_example.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example for generating and exporting internal key</p>
<div class="fragment"><div class="line"><span class="comment">/*--------------------------------------------------------------------------*/</span></div><div class="line"><span class="comment">/* Copyright 2022-2023 NXP                                                  */</span></div><div class="line"><span class="comment">/*                                                                          */</span></div><div class="line"><span class="comment">/* NXP Confidential. This software is owned or controlled by NXP and may    */</span></div><div class="line"><span class="comment">/* only be used strictly in accordance with the applicable license terms.   */</span></div><div class="line"><span class="comment">/* By expressly accepting such terms or by downloading, installing,         */</span></div><div class="line"><span class="comment">/* activating and/or otherwise using the software, you are agreeing that    */</span></div><div class="line"><span class="comment">/* you have read, and that you agree to comply with and are bound by, such  */</span></div><div class="line"><span class="comment">/* license terms. If you do not agree to be bound by the applicable license */</span></div><div class="line"><span class="comment">/* terms, then you may not retain, install, activate or otherwise use the   */</span></div><div class="line"><span class="comment">/* software.                                                                */</span></div><div class="line"><span class="comment">/*--------------------------------------------------------------------------*/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;common.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00389.html">mcuxClEls.h</a>&gt;</span> <span class="comment">// Interface to the entire mcuxClEls component</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00629.html">mcuxClSession.h</a>&gt;</span> <span class="comment">// Interface to the entire mcuxClSession component</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00485.html">mcuxClKey.h</a>&gt;</span> <span class="comment">// Interface to the entire mcuxClKey component</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00656.html">mcuxCsslFlowProtection.h</a>&gt;</span> <span class="comment">// Code flow protection</span></div><div class="line"><span class="preprocessor">#include &lt;mcuxClToolchain.h&gt;</span> <span class="comment">// memory segment definitions</span></div><div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span>  <span class="comment">// bool type for the example&#39;s return code</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00575.html">mcuxClPsaDriver.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;mcuxClCore_Examples.h&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t expectKeyRet[<a name="a0"></a><a class="code" href="a00782.html#ga7298491d4e2d679496d0bacab6f351f8">MCUXCLELS_ECC_PUBLICKEY_SIZE</a>] __attribute__ ((aligned (4))) =</div><div class="line">{</div><div class="line">    0x8b, 0xb1, 0x94, 0xb4, 0xaa, 0xa6, 0xd5, 0x73, 0xde, 0x81, 0xdd, 0x4a, 0xfd, 0x0a, 0x28, 0x5c,</div><div class="line">    0x53, 0x57, 0x42, 0x9e, 0x81, 0x3a, 0x56, 0x90, 0x42, 0xbe, 0x91, 0xd2, 0x7a, 0xbd, 0x67, 0x20,</div><div class="line">    0xb1, 0x39, 0xef, 0x56, 0x3c, 0x33, 0x7f, 0x08, 0xf0, 0x2b, 0x3a, 0xa2, 0xbf, 0x53, 0xe8, 0x2c,</div><div class="line">    0x02, 0xe9, 0xb7, 0x84, 0x6f, 0xec, 0xef, 0x87, 0xd0, 0x96, 0x63, 0x3f, 0x93, 0x80, 0x0a, 0x3e</div><div class="line">};</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t privateKey[32u] __attribute__ ((aligned (4))) =</div><div class="line">{</div><div class="line">    0x5d, 0x6a, 0x75, 0xe6, 0x84, 0x8d, 0xd5, 0xc7, 0x93, 0xd0, 0x1c, 0xc0, 0x08, 0xac, 0x72, 0x93,</div><div class="line">    0x8b, 0x70, 0x01, 0xd3, 0x38, 0x6c, 0x0d, 0x31, 0xa0, 0xeb, 0x2c, 0x0f, 0x72, 0x24, 0x09, 0x65</div><div class="line">};</div><div class="line"><span class="preprocessor">#define LIFETIME_INTERNAL PSA_KEY_LIFETIME_FROM_PERSISTENCE_AND_LOCATION(PSA_KEY_LIFETIME_VOLATILE, PSA_KEY_LOCATION_EXTERNAL_STORAGE)</span></div><div class="line"><span class="preprocessor">#define LIFETIME_EXTERNAL PSA_KEY_LIFETIME_FROM_PERSISTENCE_AND_LOCATION(PSA_KEY_LIFETIME_VOLATILE, PSA_KEY_LOCATION_LOCAL_STORAGE)</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> <a name="a1"></a><a class="code" href="a00251.html#a325f97a9cfe0c10829bec5763bfc4e92">load_key_udf</a>(</div><div class="line">    <a class="code" href="a00821.html#ga769227492b28ef0d58a94b202113cee8">mcuxClEls_KeyIndex_t</a> targetKeyIdx,       </div><div class="line">    <a name="_a2"></a><a class="code" href="a01287.html">mcuxClEls_KeyProp_t</a> targetKeyProperties, </div><div class="line">    uint8_t * pOutKey                       </div><div class="line">)</div><div class="line">{</div><div class="line">    uint8_t keyprov_external_part1[MCUXCLELS_KEYPROV_KEY_PART_1_SIZE]  = {</div><div class="line">        0x02, 0xed, 0x0c, 0xee, 0x10, 0x3d, 0x7b, 0x5a,</div><div class="line">        0x74, 0xbf, 0x2e, 0xdf, 0x9f, 0x08, 0x68, 0xb6,</div><div class="line">        0x4c, 0xba, 0xb9, 0xa2, 0xe9, 0xb5, 0x66, 0x05,</div><div class="line">        0xc2, 0x87, 0xa7, 0xa9, 0x40, 0x6f, 0xe6, 0x29</div><div class="line">    };</div><div class="line"></div><div class="line">    uint8_t keyprov_external_part2[36]  = {</div><div class="line">        0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,</div><div class="line">        0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,</div><div class="line">        0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,</div><div class="line">        0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,</div><div class="line">        0x22, 0x22, 0x22, 0x22</div><div class="line">    };</div><div class="line">    <span class="comment">// Desired key value</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">static</span> uint8_t aes256_key[<a name="a3"></a><a class="code" href="a00754.html#ga474b8fd0f1e5832a4ba327ba7aee3520">MCUXCLELS_CIPHER_KEY_SIZE_AES_256</a>] = {</div><div class="line">      0x4a, 0xdf, 0x2d, 0xd0, 0x0c, 0x88, 0xc7, 0x27,</div><div class="line">      0x89, 0x00, 0x80, 0xc8, 0x65, 0x8a, 0x26, 0x54,</div><div class="line">      0xee, 0x72, 0x57, 0x7b, 0x51, 0x42, 0xce, 0xe7,</div><div class="line">      0x54, 0x9a, 0x67, 0xb2, 0x96, 0x63, 0x4c, 0x68</div><div class="line">    };</div><div class="line"></div><div class="line">    mcuxClEls_KeyProvisionOption_t options;</div><div class="line">    options.word.value = 0;</div><div class="line">    options.bits.noic  = 1;</div><div class="line"></div><div class="line">    <a name="a4"></a><a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(ret_KeyProvision, token_KeyProvision, mcuxClEls_KeyProvision_Async(</div><div class="line">            options,</div><div class="line">            keyprov_external_part1,</div><div class="line">            keyprov_external_part2,</div><div class="line">            <span class="keyword">sizeof</span>(keyprov_external_part2),</div><div class="line">            targetKeyIdx,</div><div class="line">            targetKeyProperties</div><div class="line">    ));</div><div class="line">    <span class="keywordflow">if</span> ((<a name="a5"></a><a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(mcuxClEls_KeyProvision_Async) != token_KeyProvision) || (<a name="a6"></a><a class="code" href="a00820.html#ga0c69ecf4e48929c38549c8b430dae4b2">MCUXCLELS_STATUS_OK_WAIT</a> != ret_KeyProvision))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Expect that no error occurred, meaning that the mcuxClEls_EccKeyGen_Async operation was started.</span></div><div class="line">    }</div><div class="line">    <a name="a7"></a><a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(ret_WaitForOperation, token_WaitForOperation, <a name="a8"></a><a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>(<a name="a9"></a><a class="code" href="a00768.html#ga3528b1fa2b3c39524898299a3a90a753">MCUXCLELS_ERROR_FLAGS_CLEAR</a>));</div><div class="line">    <span class="keywordflow">if</span> ((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>) != token_WaitForOperation) || (<a name="a10"></a><a class="code" href="a00820.html#ga022996920a649ed71428ed73e53eae8a">MCUXCLELS_STATUS_OK</a> != ret_WaitForOperation))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Expect that no error occurred, meaning that the mcuxClEls_EccKeyGen_Async operation was started.</span></div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (NULL != pOutKey)</div><div class="line">    {</div><div class="line">        <a name="a11"></a><a class="code" href="a00918.html#ga268f9c22cb59586556e0cbb21ac3320e">MCUX_CSSL_FP_FUNCTION_CALL_VOID_BEGIN</a>(token, <a name="a12"></a><a class="code" href="a00863.html#gab564183ab5f02cf11b66b6244ba2112a">mcuxClMemory_copy</a> (&amp;pOutKey[0],</div><div class="line">                                                                     aes256_key,</div><div class="line">                                                                     <a class="code" href="a00754.html#ga474b8fd0f1e5832a4ba327ba7aee3520">MCUXCLELS_CIPHER_KEY_SIZE_AES_256</a>,</div><div class="line">                                                                     <a class="code" href="a00754.html#ga474b8fd0f1e5832a4ba327ba7aee3520">MCUXCLELS_CIPHER_KEY_SIZE_AES_256</a>));</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00863.html#gab564183ab5f02cf11b66b6244ba2112a">mcuxClMemory_copy</a>) != token)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a name="a13"></a><a class="code" href="a00918.html#ga30de6960e0ce17187bce680980617f38">MCUX_CSSL_FP_FUNCTION_CALL_VOID_END</a>();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> <a name="a14"></a><a class="code" href="a00251.html#a65fd6402d13f2df2135f2e1e8ade2200">rfc3394_wrap</a>(</div><div class="line">    <span class="keyword">const</span> uint8_t * pInput,         <span class="comment">//&lt; pointer to key to be wrapped</span></div><div class="line">    <span class="keywordtype">size_t</span> inputLength,             <span class="comment">//&lt; length of key to be wrapped in bytes</span></div><div class="line">    <a class="code" href="a00821.html#ga769227492b28ef0d58a94b202113cee8">mcuxClEls_KeyIndex_t</a> keyIdx,     <span class="comment">//&lt; keyslot index of key wrapping key</span></div><div class="line">    uint8_t * pOutput,              <span class="comment">//&lt; pointer to output buffer, size has to be inputLength + 16 bytes</span></div><div class="line">    <a class="code" href="a01287.html">mcuxClEls_KeyProp_t</a> properties   <span class="comment">//&lt; properties of the key to be wrapped</span></div><div class="line">)</div><div class="line">{</div><div class="line">    uint32_t concat[<a name="a15"></a><a class="code" href="a00752.html#ga36ebb8ab2b019997c6cf2c9d15b944b0">MCUXCLELS_CIPHER_BLOCK_SIZE_AES</a>/<span class="keyword">sizeof</span>(uint32_t)] = { 0u };</div><div class="line"></div><div class="line">    uint32_t input[<a class="code" href="a00752.html#ga36ebb8ab2b019997c6cf2c9d15b944b0">MCUXCLELS_CIPHER_BLOCK_SIZE_AES</a>/<span class="keyword">sizeof</span>(uint32_t)] = { 0u };</div><div class="line"></div><div class="line">    <span class="comment">// Intermediate state is stored in pOutput as it is large enough</span></div><div class="line"></div><div class="line">    <span class="comment">// initialize buffer</span></div><div class="line">    concat[0] = 0xA6A6A6A6u;   <span class="comment">// first half of concat is the A from the standard, initialized to RFC3394 IV</span></div><div class="line">    concat[1] = 0xA6A6A6A6u;</div><div class="line">    concat[2] = properties.<a name="a16"></a><a class="code" href="a01287.html#a8a1cf10e85d737a1edb9e6cbcf51a635">word</a>.<a name="a17"></a><a class="code" href="a01287.html#af184a952f255348629f27f24c0fd0bd9">value</a>;  <span class="comment">// second half of concat is R(input)/B(output), first R consists of properties...</span></div><div class="line">    concat[3] = 0x00000000u;            <span class="comment">// ... and ELS padding (zeros)</span></div><div class="line">    concat[2] = (concat[2] &lt;&lt; 24u) | (concat[2] &gt;&gt; 24u) | ((concat[2] &amp; 0x0000ff00u) &lt;&lt; 8u) | ((concat[2] &gt;&gt; 8u) &amp; 0x0000ff00u); <span class="comment">// swap endianness</span></div><div class="line"></div><div class="line">    <span class="comment">// initialize ELS encryption parameters</span></div><div class="line">    <a name="_a18"></a><a class="code" href="a01071.html">mcuxClEls_CipherOption_t</a> cipher_options;</div><div class="line">    cipher_options.<a name="a19"></a><a class="code" href="a01071.html#afd7050544cd985c2dda66061e0f0c44f">word</a>.<a name="a20"></a><a class="code" href="a01071.html#a1c724d7ce478fcbb4cdd0ccb5c1fd899">value</a>   = 0;</div><div class="line">    cipher_options.<a name="a21"></a><a class="code" href="a01071.html#af61168dc7998ed7862a56c85b64871c0">bits</a>.<a name="a22"></a><a class="code" href="a01071.html#a2e1e4a5d815c2559f0ef02e4fd0e5523">cphmde</a>  = <a name="a23"></a><a class="code" href="a00753.html#ga6f585946c286cebc74b291c520eaaec9">MCUXCLELS_CIPHERPARAM_ALGORITHM_AES_ECB</a>;</div><div class="line">    cipher_options.<a class="code" href="a01071.html#af61168dc7998ed7862a56c85b64871c0">bits</a>.<a name="a24"></a><a class="code" href="a01071.html#ada47dbd9ac0d8ed1b171e4742ed5d73a">dcrpt</a>   = <a name="a25"></a><a class="code" href="a00753.html#ga9840411e958cd2b7312c7e62e5dc06d0">MCUXCLELS_CIPHER_ENCRYPT</a>;</div><div class="line">    cipher_options.<a class="code" href="a01071.html#af61168dc7998ed7862a56c85b64871c0">bits</a>.<a name="a26"></a><a class="code" href="a01071.html#a833ce63bdab590215c35b82767479eee">extkey</a>  = 0;</div><div class="line"></div><div class="line">    <span class="comment">// input has to be multiple of 64 bits</span></div><div class="line">    <span class="keywordflow">if</span> (inputLength % <span class="keyword">sizeof</span>(uint64_t) != 0u)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    uint32_t *pSource = (uint32_t*) pInput;</div><div class="line">    uint32_t *pDest   = (uint32_t*) pOutput;</div><div class="line">    uint32_t std_n = inputLength/<span class="keyword">sizeof</span>(uint64_t) + 1; <span class="comment">// n value from standard</span></div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> jdx = 0u; jdx &lt; 6u; jdx++)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> idx = 0u; idx &lt; std_n; idx++)</div><div class="line">        {</div><div class="line">            input[0]=concat[0];</div><div class="line">            input[1]=concat[1];</div><div class="line">            input[2]=concat[2];</div><div class="line">            input[3]=concat[3];</div><div class="line"></div><div class="line">            <span class="comment">// Encrypt concatenated A and chunk to be processed</span></div><div class="line">            <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a name="a27"></a><a class="code" href="a00756.html#gad8b0506b0510f7dc6ef20fd488ee004b">mcuxClEls_Cipher_Async</a>(</div><div class="line">                cipher_options,</div><div class="line">                keyIdx,</div><div class="line">                NULL,</div><div class="line">                0u,</div><div class="line">                (uint8_t*) input,</div><div class="line">                <a class="code" href="a00752.html#ga36ebb8ab2b019997c6cf2c9d15b944b0">MCUXCLELS_CIPHER_BLOCK_SIZE_AES</a>,</div><div class="line">                NULL,</div><div class="line">                (uint8_t*) concat));</div><div class="line">            <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00756.html#gad8b0506b0510f7dc6ef20fd488ee004b">mcuxClEls_Cipher_Async</a>) != token) || (<a class="code" href="a00820.html#ga0c69ecf4e48929c38549c8b430dae4b2">MCUXCLELS_STATUS_OK_WAIT</a> != result))</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">            <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">            <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>(<a class="code" href="a00768.html#ga3528b1fa2b3c39524898299a3a90a753">MCUXCLELS_ERROR_FLAGS_CLEAR</a>));</div><div class="line">            <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>) != token) || (<a class="code" href="a00820.html#ga022996920a649ed71428ed73e53eae8a">MCUXCLELS_STATUS_OK</a> != result))</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">            <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">            <span class="comment">// Write out processed key chunk</span></div><div class="line">            pDest[2u*idx + 2u] = concat[2u];</div><div class="line">            pDest[2u*idx + 3u] = concat[3u];</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span>( idx == std_n - 1u)</div><div class="line">            {</div><div class="line">                <span class="comment">// Load next key chunk</span></div><div class="line">                concat[2u] = pDest[2u];</div><div class="line">                concat[3u] = pDest[3u];</div><div class="line">                pSource = pDest + 4;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                <span class="comment">// Load next key chunk</span></div><div class="line">                concat[2u] = pSource[2u*idx + 0u];</div><div class="line">                concat[3u] = pSource[2u*idx + 1u];</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="comment">// XOR round constant into A</span></div><div class="line">            uint32_t gdx = std_n * jdx + (idx+1);  <span class="comment">// all values should fit into a uint32_t</span></div><div class="line">            gdx = (gdx &lt;&lt; 24u) | (gdx &gt;&gt; 24u) | ((gdx &amp; 0x0000ff00u) &lt;&lt; 8u) | ((gdx &gt;&gt; 8u) &amp; 0x0000ff00u); <span class="comment">// swap endianness</span></div><div class="line">            concat[1u] ^= gdx;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="comment">// Write out processed key chunk</span></div><div class="line">    pDest[0u] = concat[0u];</div><div class="line">    pDest[1u] = concat[1u];</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> mcuxClPsaDriver_keygen_export_public_key_oracle_example(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Enable ELS */</span></div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a name="a28"></a><a class="code" href="a00774.html#ga6dbf394b38add1c6967dab368435b657">mcuxClEls_Enable_Async</a>()); <span class="comment">// Enable the ELS.</span></div><div class="line">    <span class="comment">// mcuxClEls_Enable_Async is a flow-protected function: Check the protection token and the return value</span></div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#ga6dbf394b38add1c6967dab368435b657">mcuxClEls_Enable_Async</a>) != token) || (<a class="code" href="a00820.html#ga0c69ecf4e48929c38549c8b430dae4b2">MCUXCLELS_STATUS_OK_WAIT</a> != result))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>(<a class="code" href="a00768.html#ga3528b1fa2b3c39524898299a3a90a753">MCUXCLELS_ERROR_FLAGS_CLEAR</a>)); <span class="comment">// Wait for the mcuxClEls_Enable_Async operation to complete.</span></div><div class="line">    <span class="comment">// mcuxClEls_WaitForOperation is a flow-protected function: Check the protection token and the return value</span></div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>) != token) || (<a class="code" href="a00820.html#ga022996920a649ed71428ed73e53eae8a">MCUXCLELS_STATUS_OK</a> != result))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">    <span class="comment">/* Step 0.1:</span></div><div class="line"><span class="comment">        Reset ELS</span></div><div class="line"><span class="comment">        Note: this should better happen in the test framework CLNS-395</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a name="a29"></a><a class="code" href="a00774.html#ga988b48898347ef4de0912cae0f631764">mcuxClEls_Reset_Async</a>(<a name="a30"></a><a class="code" href="a00769.html#ga1f4338ba7f7d0ddd5b84236bc4545ee3">MCUXCLELS_RESET_CANCEL</a>));</div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#ga988b48898347ef4de0912cae0f631764">mcuxClEls_Reset_Async</a>) != token) || (<a class="code" href="a00820.html#ga0c69ecf4e48929c38549c8b430dae4b2">MCUXCLELS_STATUS_OK_WAIT</a> != result))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>(<a class="code" href="a00768.html#ga3528b1fa2b3c39524898299a3a90a753">MCUXCLELS_ERROR_FLAGS_CLEAR</a>)); <span class="comment">// Wait for the mcuxClEls_Enable_Async operation to complete.</span></div><div class="line">    <span class="comment">// mcuxClEls_WaitForOperation is a flow-protected function: Check the protection token and the return value</span></div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>) != token) || (<a class="code" href="a00820.html#ga022996920a649ed71428ed73e53eae8a">MCUXCLELS_STATUS_OK</a> != result))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">    <span class="comment">/**********************************************************************************************/</span></div><div class="line">    <span class="comment">/*************************** Example Gen key pair *********************************************/</span></div><div class="line">    <span class="comment">/**********************************************************************************************/</span></div><div class="line">    <span class="comment">/* Set up PSA key attributes. */</span></div><div class="line">    psa_key_attributes_t attributes = {</div><div class="line">      .core = {                                                               <span class="comment">// Core attributes</span></div><div class="line">        .type = PSA_KEY_TYPE_ECC_KEY_PAIR(PSA_ECC_FAMILY_SECP_R1),            <span class="comment">// Keypair family with curve p-256</span></div><div class="line">        .bits = 256U,                                                         <span class="comment">// Key bits of a curve p-256</span></div><div class="line">        .lifetime = LIFETIME_INTERNAL,                                        <span class="comment">// Volatile (RAM), S50 Temporary Storage for private key</span></div><div class="line">        .id = 6U,                                                             <span class="comment">// private key slot</span></div><div class="line">        .policy = {</div><div class="line">          .usage = PSA_ALG_NONE,</div><div class="line">          .alg = PSA_ALG_ECDSA_ANY,</div><div class="line">          .alg2 = PSA_ALG_NONE},</div><div class="line">        .flags = 0U},                                                         <span class="comment">// No flags</span></div><div class="line">      .domain_parameters = NULL,</div><div class="line">      .domain_parameters_size = 0U};</div><div class="line"></div><div class="line">    <span class="comment">/* Call generate_key operation */</span></div><div class="line">    uint32_t keyBuffer[32u/<span class="keyword">sizeof</span>(uint32_t)] = {0};</div><div class="line">    <span class="keywordtype">size_t</span> key_buffer_length = 0U;</div><div class="line"></div><div class="line">    psa_status_t status = psa_driver_wrapper_generate_key(</div><div class="line">                &amp;attributes,</div><div class="line">                (uint8_t*)keyBuffer, <span class="keyword">sizeof</span>(keyBuffer), &amp;key_buffer_length );</div><div class="line"></div><div class="line">    <span class="comment">/* Check the return value */</span></div><div class="line">    <span class="keywordflow">if</span>(status != PSA_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Check the output length */</span></div><div class="line">    <span class="keywordflow">if</span>(key_buffer_length != 32u)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/**********************************************************************************************/</span></div><div class="line">    <span class="comment">/*************************** Export SECP_R1 curve public key***********************************/</span></div><div class="line">    <span class="comment">/**********************************************************************************************/</span></div><div class="line">    <span class="comment">/* Step 1:</span></div><div class="line"><span class="comment">         Execute KEYPROV command</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <a class="code" href="a00821.html#ga769227492b28ef0d58a94b202113cee8">mcuxClEls_KeyIndex_t</a> keyIdxKwk = 4U;</div><div class="line">    <a class="code" href="a00821.html#ga769227492b28ef0d58a94b202113cee8">mcuxClEls_KeyIndex_t</a> aesHelperKeyIdx = 10U;</div><div class="line">    <a class="code" href="a00821.html#ga769227492b28ef0d58a94b202113cee8">mcuxClEls_KeyIndex_t</a>  keyIdxExp = 14U;</div><div class="line"></div><div class="line">    <a class="code" href="a01287.html">mcuxClEls_KeyProp_t</a>          keyProp;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a8a1cf10e85d737a1edb9e6cbcf51a635">word</a>.<a class="code" href="a01287.html#af184a952f255348629f27f24c0fd0bd9">value</a>       = 0u;</div><div class="line">    keyProp.<a name="a31"></a><a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a name="a32"></a><a class="code" href="a01287.html#a006a40e53f4859e41e4b4ec5424c6c26">ukwk</a>        = <a name="a33"></a><a class="code" href="a00819.html#ga8f78e035c0c348d9c95250cbb5c06bdc">MCUXCLELS_KEYPROPERTY_KWK_TRUE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a name="a34"></a><a class="code" href="a01287.html#a49806c0136f41b701675799cb69d34d5">ksize</a>       = <a name="a35"></a><a class="code" href="a00819.html#ga755a270fd53677522cafd0e56a6be66f">MCUXCLELS_KEYPROPERTY_KEY_SIZE_256</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a name="a36"></a><a class="code" href="a01287.html#ad0617bc9eea63043b1faf5fe9814ba97">kactv</a>       = <a name="a37"></a><a class="code" href="a00819.html#ga80e7d70c48a472dba6067d6b8e97bb68">MCUXCLELS_KEYPROPERTY_ACTIVE_TRUE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a name="a38"></a><a class="code" href="a01287.html#a50d3bbaabf919fab908e2ae83fe5a5ab">upprot_priv</a> = <a name="a39"></a><a class="code" href="a00819.html#gaa613ab074bf3fc6b9f90a69f505d2e28">MCUXCLELS_KEYPROPERTY_PRIVILEGED_FALSE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a name="a40"></a><a class="code" href="a01287.html#a0d130be83d337e7a5d9ef56f4a92f3a0">upprot_sec</a>  = <a name="a41"></a><a class="code" href="a00819.html#gae85a65c3e6ae36cc74de69fa6a562a7a">MCUXCLELS_KEYPROPERTY_SECURE_FALSE</a>;</div><div class="line">    <span class="keywordtype">bool</span> keyProv_result = <a class="code" href="a00251.html#a325f97a9cfe0c10829bec5763bfc4e92">load_key_udf</a>(keyIdxKwk, keyProp, NULL);</div><div class="line">    <span class="keywordflow">if</span> (!keyProv_result)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    keyProp.<a class="code" href="a01287.html#a8a1cf10e85d737a1edb9e6cbcf51a635">word</a>.<a class="code" href="a01287.html#af184a952f255348629f27f24c0fd0bd9">value</a> = 0u;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a class="code" href="a01287.html#a50d3bbaabf919fab908e2ae83fe5a5ab">upprot_priv</a> = <a name="a42"></a><a class="code" href="a00819.html#ga45d5d7ba7da1060c55a4bac5279841cc">MCUXCLELS_KEYPROPERTY_PRIVILEGED_TRUE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a class="code" href="a01287.html#a0d130be83d337e7a5d9ef56f4a92f3a0">upprot_sec</a> =  <a name="a43"></a><a class="code" href="a00819.html#ga2088d83e8ab366a72075f52e3ca352ad">MCUXCLELS_KEYPROPERTY_SECURE_TRUE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a name="a44"></a><a class="code" href="a01287.html#a18d3c3d356100d7bd01a9950c1f7b81e">uaes</a> = <a name="a45"></a><a class="code" href="a00819.html#gae292b4575efaa152a6a2704c05e079c7">MCUXCLELS_KEYPROPERTY_AES_TRUE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a class="code" href="a01287.html#a49806c0136f41b701675799cb69d34d5">ksize</a> = <a class="code" href="a00819.html#ga755a270fd53677522cafd0e56a6be66f">MCUXCLELS_KEYPROPERTY_KEY_SIZE_256</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a class="code" href="a01287.html#ad0617bc9eea63043b1faf5fe9814ba97">kactv</a> = <a class="code" href="a00819.html#ga80e7d70c48a472dba6067d6b8e97bb68">MCUXCLELS_KEYPROPERTY_ACTIVE_TRUE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a name="a46"></a><a class="code" href="a01287.html#ac8a7a5dac0515241438c5086d60ffcd2">kbase</a> = <a name="a47"></a><a class="code" href="a00819.html#ga8a549e38eaccd502bd48a82e95ff20f2">MCUXCLELS_KEYPROPERTY_BASE_SLOT</a>;</div><div class="line">    <span class="keywordtype">bool</span> keyProv_result2 = <a class="code" href="a00251.html#a325f97a9cfe0c10829bec5763bfc4e92">load_key_udf</a>(aesHelperKeyIdx, keyProp, NULL);</div><div class="line">    <span class="keywordflow">if</span> (!keyProv_result2)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Step 2:</span></div><div class="line"><span class="comment">         Import private key</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    uint8_t key_rfc3394[<a name="a48"></a><a class="code" href="a00810.html#ga46c8e56ff10c6a6ecb28c511cd32178c">MCUXCLELS_RFC3394_CONTAINER_SIZE_256</a>];</div><div class="line">    keyProp.<a class="code" href="a01287.html#a8a1cf10e85d737a1edb9e6cbcf51a635">word</a>.<a class="code" href="a01287.html#af184a952f255348629f27f24c0fd0bd9">value</a>       = 0u;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a class="code" href="a01287.html#a49806c0136f41b701675799cb69d34d5">ksize</a>       = <a class="code" href="a00819.html#ga755a270fd53677522cafd0e56a6be66f">MCUXCLELS_KEYPROPERTY_KEY_SIZE_256</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a class="code" href="a01287.html#ad0617bc9eea63043b1faf5fe9814ba97">kactv</a>       = <a class="code" href="a00819.html#ga80e7d70c48a472dba6067d6b8e97bb68">MCUXCLELS_KEYPROPERTY_ACTIVE_TRUE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a name="a49"></a><a class="code" href="a01287.html#ac4fbcd8af04b845353857e27ae6e90b8">ukgsrc</a>      = <a name="a50"></a><a class="code" href="a00819.html#ga65bc587af872d79766a1990b644d65ad">MCUXCLELS_KEYPROPERTY_INPUT_FOR_ECC_TRUE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a class="code" href="a01287.html#a50d3bbaabf919fab908e2ae83fe5a5ab">upprot_priv</a> = <a class="code" href="a00819.html#gaa613ab074bf3fc6b9f90a69f505d2e28">MCUXCLELS_KEYPROPERTY_PRIVILEGED_FALSE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a class="code" href="a01287.html#a0d130be83d337e7a5d9ef56f4a92f3a0">upprot_sec</a>  = <a class="code" href="a00819.html#gae85a65c3e6ae36cc74de69fa6a562a7a">MCUXCLELS_KEYPROPERTY_SECURE_FALSE</a>;</div><div class="line">    keyProp.<a class="code" href="a01287.html#a4149a35dfbd1db650f8a16d50fe58ae1">bits</a>.<a name="a51"></a><a class="code" href="a01287.html#a8b01f95eb9069953fe7a48b6ec85e479">wrpok</a>       = <a name="a52"></a><a class="code" href="a00819.html#gaf07168a64eb99d5788e096d735871c3f">MCUXCLELS_KEYPROPERTY_WRAP_TRUE</a>;</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> wrap_result = <a class="code" href="a00251.html#a65fd6402d13f2df2135f2e1e8ade2200">rfc3394_wrap</a>(privateKey,</div><div class="line">                                    <a class="code" href="a00754.html#ga474b8fd0f1e5832a4ba327ba7aee3520">MCUXCLELS_CIPHER_KEY_SIZE_AES_256</a>,</div><div class="line">                                    aesHelperKeyIdx,</div><div class="line">                                    key_rfc3394,</div><div class="line">                                    keyProp);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!wrap_result)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a name="_a53"></a><a class="code" href="a01275.html">mcuxClEls_KeyImportOption_t</a> import_options;</div><div class="line">    import_options.<a name="a54"></a><a class="code" href="a01275.html#a49ea84f1e5b1d90492fb52073fa3ad05">word</a>.<a name="a55"></a><a class="code" href="a01275.html#ad5bfabd7e1e04a95627e0cbc144afdcb">value</a> = 0u;</div><div class="line">    import_options.<a name="a56"></a><a class="code" href="a01275.html#a14f4cd02fec51f8c54d807da55c1d2f5">bits</a>.<a name="a57"></a><a class="code" href="a01275.html#ae3892b035704c00a855dd43d96a21b2c">kfmt</a> = <a name="a58"></a><a class="code" href="a00809.html#gaa3f8c4e99d3c233eeaa2685d9e0d4b67">MCUXCLELS_KEYIMPORT_KFMT_RFC3394</a>;</div><div class="line"></div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(ret_KeyImport, token_KeyImport, <a name="a59"></a><a class="code" href="a00812.html#ga867d4be563b347273af25a559abd7f87">mcuxClEls_KeyImport_Async</a>(import_options, key_rfc3394, <a class="code" href="a00810.html#ga46c8e56ff10c6a6ecb28c511cd32178c">MCUXCLELS_RFC3394_CONTAINER_SIZE_256</a>, keyIdxKwk, keyIdxExp));</div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00812.html#ga867d4be563b347273af25a559abd7f87">mcuxClEls_KeyImport_Async</a>) != token_KeyImport) || (<a class="code" href="a00820.html#ga0c69ecf4e48929c38549c8b430dae4b2">MCUXCLELS_STATUS_OK_WAIT</a> != ret_KeyImport))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>(<a class="code" href="a00768.html#ga3528b1fa2b3c39524898299a3a90a753">MCUXCLELS_ERROR_FLAGS_CLEAR</a>));</div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>) != token) || (<a class="code" href="a00820.html#ga022996920a649ed71428ed73e53eae8a">MCUXCLELS_STATUS_OK</a> != result))</div><div class="line">    {</div><div class="line">         <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">    <span class="comment">/* Step 3:</span></div><div class="line"><span class="comment">         Call export_public_key operation</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    uint8_t data[<a class="code" href="a00782.html#ga7298491d4e2d679496d0bacab6f351f8">MCUXCLELS_ECC_PUBLICKEY_SIZE</a>] = {0U};</div><div class="line">    <span class="keywordtype">size_t</span> data_size = <a class="code" href="a00782.html#ga7298491d4e2d679496d0bacab6f351f8">MCUXCLELS_ECC_PUBLICKEY_SIZE</a>;</div><div class="line">    <span class="keywordtype">size_t</span> data_length = 0U;</div><div class="line">    attributes.core.policy.usage = PSA_KEY_USAGE_EXPORT;</div><div class="line">    status = psa_driver_wrapper_export_public_key(</div><div class="line">                &amp;attributes,</div><div class="line">                (uint8_t*)&amp;keyIdxExp,  <span class="keyword">sizeof</span>(privateKey),</div><div class="line">                data, data_size, &amp;data_length );</div><div class="line"></div><div class="line">    <span class="comment">/* Check the return value */</span></div><div class="line">    <span class="keywordflow">if</span>(status != PSA_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Check the output length */</span></div><div class="line">    <span class="keywordflow">if</span>(data_length != <a class="code" href="a00782.html#ga7298491d4e2d679496d0bacab6f351f8">MCUXCLELS_ECC_PUBLICKEY_SIZE</a>)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <span class="comment">/**************************************************************************/</span></div><div class="line">    <span class="comment">/* Verification of the result                                             */</span></div><div class="line">    <span class="comment">/**************************************************************************/</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0U; i &lt; <span class="keyword">sizeof</span>(data_length); i++)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (data[i] != expectKeyRet[i])</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>(<a class="code" href="a00768.html#ga3528b1fa2b3c39524898299a3a90a753">MCUXCLELS_ERROR_FLAGS_CLEAR</a>)); <span class="comment">// Wait for the mcuxClEls_KeyDelete_Async operation to complete.</span></div><div class="line">    <span class="comment">// mcuxClEls_LimitedWaitForOperation is a flow-protected function: Check the protection token and the return value</span></div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>) != token) || (<a class="code" href="a00820.html#ga022996920a649ed71428ed73e53eae8a">MCUXCLELS_STATUS_OK</a> != result))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">    <span class="comment">/*Step 4:</span></div><div class="line"><span class="comment">        Delete kwk and helperkey slot</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a name="a60"></a><a class="code" href="a00812.html#ga035d072c033f988194110973581c6303">mcuxClEls_KeyDelete_Async</a>(keyIdxKwk));</div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00812.html#ga035d072c033f988194110973581c6303">mcuxClEls_KeyDelete_Async</a>) != token) || (<a class="code" href="a00820.html#ga0c69ecf4e48929c38549c8b430dae4b2">MCUXCLELS_STATUS_OK_WAIT</a> != result))</div><div class="line">    {</div><div class="line">         <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>(<a class="code" href="a00768.html#ga3528b1fa2b3c39524898299a3a90a753">MCUXCLELS_ERROR_FLAGS_CLEAR</a>));</div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>) != token) || (<a class="code" href="a00820.html#ga022996920a649ed71428ed73e53eae8a">MCUXCLELS_STATUS_OK</a> != result))</div><div class="line">    {</div><div class="line">         <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a class="code" href="a00812.html#ga035d072c033f988194110973581c6303">mcuxClEls_KeyDelete_Async</a>(aesHelperKeyIdx));</div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00812.html#ga035d072c033f988194110973581c6303">mcuxClEls_KeyDelete_Async</a>) != token) || (<a class="code" href="a00820.html#ga0c69ecf4e48929c38549c8b430dae4b2">MCUXCLELS_STATUS_OK_WAIT</a> != result))</div><div class="line">    {</div><div class="line">         <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>(<a class="code" href="a00768.html#ga3528b1fa2b3c39524898299a3a90a753">MCUXCLELS_ERROR_FLAGS_CLEAR</a>));</div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>) != token) || (<a class="code" href="a00820.html#ga022996920a649ed71428ed73e53eae8a">MCUXCLELS_STATUS_OK</a> != result))</div><div class="line">    {</div><div class="line">         <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a class="code" href="a00812.html#ga035d072c033f988194110973581c6303">mcuxClEls_KeyDelete_Async</a>(keyIdxExp));</div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00812.html#ga035d072c033f988194110973581c6303">mcuxClEls_KeyDelete_Async</a>) != token) || (<a class="code" href="a00820.html#ga0c69ecf4e48929c38549c8b430dae4b2">MCUXCLELS_STATUS_OK_WAIT</a> != result))</div><div class="line">    {</div><div class="line">         <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>(<a class="code" href="a00768.html#ga3528b1fa2b3c39524898299a3a90a753">MCUXCLELS_ERROR_FLAGS_CLEAR</a>));</div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#gaee73cb4825b7722d9e085565170eb18e">mcuxClEls_WaitForOperation</a>) != token) || (<a class="code" href="a00820.html#ga022996920a649ed71428ed73e53eae8a">MCUXCLELS_STATUS_OK</a> != result))</div><div class="line">    {</div><div class="line">         <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line">    <span class="comment">/* Disable ELS */</span></div><div class="line">    <a class="code" href="a00918.html#ga8a9b1ebbc02c8195618a339aa8e0003d">MCUX_CSSL_FP_FUNCTION_CALL_BEGIN</a>(result, token, <a name="a61"></a><a class="code" href="a00774.html#gacbf878536100314ce61081c54ea5ef9e">mcuxClEls_Disable</a>()); <span class="comment">// Disable the ELS.</span></div><div class="line">    <span class="comment">// mcuxClEls_Disable is a flow-protected function: Check the protection token and the return value</span></div><div class="line">    <span class="keywordflow">if</span>((<a class="code" href="a00918.html#gac16ad6597579a02a30ada37f86f216d5">MCUX_CSSL_FP_FUNCTION_CALLED</a>(<a class="code" href="a00774.html#gacbf878536100314ce61081c54ea5ef9e">mcuxClEls_Disable</a>) != token) || (<a class="code" href="a00820.html#ga022996920a649ed71428ed73e53eae8a">MCUXCLELS_STATUS_OK</a> != result))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_ERROR;</div><div class="line">    }</div><div class="line">    <a class="code" href="a00918.html#gac4362de43d0e67ba6fac0057eb38008d">MCUX_CSSL_FP_FUNCTION_CALL_END</a>();</div><div class="line"></div><div class="line">    <span class="comment">/* Return */</span></div><div class="line">    <span class="keywordflow">return</span> MCUXCLEXAMPLE_STATUS_OK;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
